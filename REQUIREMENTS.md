# Todo アプリケーション 要件定義書

## プロジェクト概要

Spring AIの学習を目的としたシンプルなTodoアプリケーション。
現時点ではAI機能は含めず、基本的なTodo管理機能とマルチユーザー認証を実装する。

## 技術スタック

### バックエンド
- **フレームワーク**: Spring Boot 3.x
- **言語**: Kotlin 1.9以上
- **ビルドツール**: Gradle (Kotlin DSL)
- **データベース**: H2（インメモリ）
- **認証**: Spring Security + JWT
- **API**: RESTful API

### フロントエンド
- **フレームワーク**: React
- **言語**: TypeScript
- **通信**: REST API

## プロジェクト構成

### バックエンド：Gradleマルチプロジェクト構成

バックエンドは将来のMCPサーバー実装を見据えて、以下の2つのモジュールに分離する：

#### 1. `todo-domain` モジュール
ドメインロジックとデータアクセス層を担当する再利用可能なライブラリモジュール。

**責務：**
- ドメインモデル（エンティティ）の定義
- リポジトリインターフェースの定義
- ビジネスロジック（サービス層）の実装
- データアクセスロジック（Spring Data JPA）
- ドメインに関する例外クラス

**主要コンポーネント：**
- `domain/model/`: エンティティクラス（User, Todo）
- `domain/repository/`: Repositoryインターフェース
- `domain/service/`: ビジネスロジック層

**依存関係：**
- Spring Data JPA
- H2 Database
- Kotlin標準ライブラリ

#### 2. `todo-api` モジュール
REST APIを提供するWebアプリケーションモジュール。

**責務：**
- REST Controllerの実装
- Spring Securityの設定（JWT認証）
- リクエスト/レスポンスDTO
- CORS設定
- エラーハンドリング
- アプリケーション起動クラス

**主要コンポーネント：**
- `api/controller/`: REST Controllerクラス
- `api/dto/`: リクエスト/レスポンスDTO
- `api/security/`: セキュリティ設定、JWTユーティリティ
- `api/config/`: 各種設定クラス

**依存関係：**
- `todo-domain`モジュール（依存）
- Spring Boot Web
- Spring Security
- JWT ライブラリ（jjwt等）

#### モジュール間の依存関係
```
todo-api → todo-domain
```

`todo-api`は`todo-domain`に依存し、ドメインロジックを利用してREST APIを提供する。
`todo-domain`は他のモジュールに依存せず、独立したライブラリとして機能する。

### 将来の拡張：MCPサーバー

将来的に`todo-mcp`モジュールを追加し、`todo-domain`を再利用してMCP (Model Context Protocol) サーバーを実装する予定。

```
todo-api → todo-domain
todo-mcp → todo-domain
```

これにより、同じドメインロジックを異なるインターフェース（REST API、MCP）で提供可能になる。

## 機能要件

### 1. ユーザー管理機能

#### 1.1 ユーザー登録
- ユーザー名とパスワードでアカウントを作成
- ユーザー名の重複チェック

#### 1.2 ログイン/ログアウト
- ユーザー名とパスワードで認証
- JWT トークンの発行
- トークンの検証
- ログアウト機能

### 2. Todo管理機能

#### 2.1 Todoのデータモデル
- **タイトル** (必須): 文字列
- **期限日**: 日付（オプション）
- **完了状態**: 真偽値（デフォルト: false）
- **作成日時**: タイムスタンプ（自動設定）
- **更新日時**: タイムスタンプ（自動更新）
- **所有者**: ユーザーID（ログインユーザーに紐づく）

#### 2.2 CRUD操作
- **作成 (Create)**: 新しいTodoを作成
- **読み取り (Read)**: 自分のTodoリストを取得
- **更新 (Update)**: 既存のTodoを編集
- **削除 (Delete)**: Todoを削除

#### 2.3 完了・未完了の切り替え
- チェックボックスで完了状態をトグル
- 完了したTodoは視覚的に区別（例：取り消し線）

#### 2.4 検索・フィルタ機能
- **キーワード検索**: タイトルで部分一致検索
- **状態フィルタ**: 全て/未完了のみ/完了のみ
- **期限フィルタ**: 期限切れ/今日期限/今週期限

#### 2.5 並び替え機能
- 作成日時（昇順/降順）
- 期限日（昇順/降順）
- タイトル（昇順/降順）
- 完了状態

## 非機能要件

### セキュリティ
- パスワードはハッシュ化して保存（BCrypt）
- JWTトークンによる認証
- ユーザーは自分のTodoのみアクセス可能
- CORS設定でフロントエンドからのアクセスを許可

### データ永続化
- H2インメモリデータベースを使用
- アプリケーション再起動時にデータは消える（開発用）
- Spring Data JPAでデータアクセス

### API設計
- RESTful API の原則に従う
- 適切なHTTPメソッドを使用（GET, POST, PUT, DELETE）
- 適切なHTTPステータスコードを返す
- JSON形式でデータをやり取り

## 画面構成（フロントエンド）

### 1. ログイン画面
- ユーザー名入力フィールド
- パスワード入力フィールド
- ログインボタン
- 新規登録リンク

### 2. ユーザー登録画面
- ユーザー名入力フィールド
- パスワード入力フィールド
- パスワード確認フィールド
- 登録ボタン
- ログインリンク

### 3. Todoリスト画面（メイン画面）
- ヘッダー
  - ログアウトボタン
  - ログインユーザー名表示
- Todo作成フォーム
  - タイトル入力フィールド
  - 期限日入力フィールド
  - 追加ボタン
- 検索・フィルタエリア
  - キーワード検索フィールド
  - 状態フィルタドロップダウン
  - 期限フィルタドロップダウン
  - 並び替えオプション
- Todoリスト
  - チェックボックス（完了切り替え）
  - タイトル
  - 期限日
  - 編集ボタン
  - 削除ボタン

### 4. Todo編集モーダル/画面
- タイトル編集フィールド
- 期限日編集フィールド
- 保存ボタン
- キャンセルボタン

## API エンドポイント仕様

### 認証関連
```
POST /api/auth/register - ユーザー登録
POST /api/auth/login - ログイン
POST /api/auth/logout - ログアウト
```

### Todo関連（要認証）
```
GET    /api/todos - Todoリスト取得（検索・フィルタ・ソートパラメータ対応）
POST   /api/todos - Todo作成
GET    /api/todos/{id} - 特定のTodo取得
PUT    /api/todos/{id} - Todo更新
DELETE /api/todos/{id} - Todo削除
PATCH  /api/todos/{id}/toggle - 完了状態トグル
```

## 今後の拡張性（Spring AI機能）

現時点では実装しないが、将来的に以下のAI機能を追加する可能性を考慮：
- タスクの自動分類・タグ付け
- 優先度の自動判定
- タスクの提案・生成
- 自然言語でのタスク作成

## 実装計画

詳細な実装TODOリストは [TODO.md](./TODO.md) を参照してください。

実装は以下のフェーズで進行します：
1. バックエンド基盤構築（マルチプロジェクト設定）
2. ドメイン層の実装（`todo-domain`）
3. API層と認証機能（`todo-api`）
4. Todo REST API実装（`todo-api`）
5. 検索・フィルタ・ソート機能
6. フロントエンド開発
7. テストとリファイニング
