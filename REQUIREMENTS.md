# 機能変更要件定義

## 目的
Spring AIの学習に集中するため、認証機能を削除してTODO管理をシンプル化する

## 変更概要
認証機能（JWT）を削除し、ユーザー選択式のTODO管理に変更する

---

## 1. 削除する機能

### 認証機能
- [x] JWT認証の削除
- [x] ログイン機能の削除
- [x] ユーザー登録（認証用）の削除
- [x] Spring Securityの認証設定の削除
- [x] フロントエンドのAuthContext削除
- [x] ログイン・登録ページの削除

---

## 2. 追加・変更する機能

### 2.1 ユーザー管理機能

#### バックエンド
- **エンティティ**: User
  - フィールド: `id` (Long), `name` (String)
  - パスワードフィールドは削除
  - 名前の一意性制約を追加

- **API エンドポイント**:
  - `POST /api/users` - ユーザー作成（名前のみ）
  - `GET /api/users` - ユーザー一覧取得
  - `GET /api/users/{id}` - ユーザー詳細取得
  - `PUT /api/users/{id}` - ユーザー名変更
  - `DELETE /api/users/{id}` - ユーザー削除

- **削除時の制約**:
  - 該当ユーザーのTODOが存在する場合は削除不可
  - エラーメッセージ: "このユーザーにはTODOが存在するため削除できません"

#### フロントエンド
- **ユーザー管理画面**:
  - ユーザー一覧表示
  - ユーザー追加フォーム（名前のみ）
  - ユーザー編集機能（名前変更）
  - ユーザー削除ボタン（TODOがある場合は無効化またはエラー表示）

### 2.2 TODO管理機能の変更

#### バックエンド
- **既存機能の維持**:
  - Todoエンティティの `userId` フィールドは維持
  - 検索、フィルタ、ソート機能は維持
  - 期限管理・期限切れ表示は維持

- **変更なし**:
  - TODOのCRUD API
  - 検索・フィルタ・ソートのロジック

#### フロントエンド
- **TODO作成フォーム**:
  - ユーザー選択ドロップダウンを追加
  - 必須フィールドとして設定

- **TODO編集フォーム**:
  - ユーザー選択ドロップダウンを追加
  - 既存のTODOの所有者変更を可能にする

- **TODO一覧画面**:
  - 全ユーザーのTODOを表示
  - ユーザーでフィルタできる機能を追加
  - 各TODOにユーザー名を表示

---

## 3. 維持する機能

### バックエンド
- [x] Spring AI MCP Server統合
- [x] H2インメモリデータベース
- [x] DDD設計（3層アーキテクチャ）
- [x] マルチモジュール構成

### フロントエンド
- [x] 検索機能（キーワード検索）
- [x] フィルタ機能（完了状態）
- [x] ソート機能（複数フィールド）
- [x] 期限管理・期限切れ表示

---

## 4. 技術的な変更詳細

### 4.1 バックエンド

#### セキュリティ設定
- Spring SecurityのJWT認証を削除
- すべてのエンドポイントを認証不要に変更
- CORS設定は維持

#### ドメイン層
- `User`エンティティからパスワード関連フィールドを削除
- ユーザー名の一意性バリデーション追加

#### インフラストラクチャ層
- `UserRepository`の簡素化
- ユーザー削除時のTODO存在チェック追加

#### API層
- `JwtTokenProvider`など認証関連クラスの削除
- `AuthController`の削除
- `UserController`の追加（シンプルなCRUD）
- `TodoController`は維持（認証チェックのみ削除）

### 4.2 フロントエンド

#### 削除
- `contexts/AuthContext.tsx`
- `pages/LoginPage.tsx`
- `pages/RegisterPage.tsx`
- ルーティングからログイン・登録ルートを削除
- Axiosインターセプターの認証ヘッダー設定を削除

#### 追加
- `pages/UsersPage.tsx` - ユーザー管理画面
- `components/UserList.tsx` - ユーザー一覧
- `components/UserForm.tsx` - ユーザー作成・編集フォーム
- `api/users.ts` - ユーザーAPI呼び出し

#### 変更
- `components/TodoForm.tsx` - ユーザー選択ドロップダウン追加
- `pages/TodosPage.tsx` - ユーザーフィルタUI追加
- ルーティング設定の更新

---

## 5. 実装の優先順位

1. **Phase 1: バックエンド - 認証削除**
   - JWT関連クラスの削除
   - Security設定の簡素化
   - Userエンティティの簡素化

2. **Phase 2: バックエンド - ユーザー管理API**
   - UserController追加
   - ユーザーCRUD実装
   - 削除時の制約チェック実装

3. **Phase 3: フロントエンド - 認証削除**
   - AuthContext削除
   - ログイン・登録ページ削除
   - ルーティング更新

4. **Phase 4: フロントエンド - ユーザー管理UI**
   - ユーザー管理画面実装
   - ユーザーCRUD UI実装

5. **Phase 5: フロントエンド - TODO機能統合**
   - TODOフォームにユーザー選択追加
   - ユーザーフィルタ追加
   - TODO一覧にユーザー名表示

---

## 6. テスト観点

### バックエンド
- ユーザー名重複時のバリデーションエラー
- TODOが存在するユーザーの削除不可
- 全エンドポイントが認証なしでアクセス可能

### フロントエンド
- ユーザー選択なしでTODO作成不可
- ユーザーフィルタの動作確認
- TODO所有者変更の動作確認

---

## 7. データ移行

既存データベースはH2インメモリのため、スキーマ変更時に自動的に再作成される。
データ移行の考慮は不要。

---

## 8. MCP Server

Spring AI MCP Server統合は維持し、学習用途に利用する。
認証削除による影響はなし。
